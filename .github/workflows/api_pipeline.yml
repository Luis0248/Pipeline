name: Pipeline de Auditoria API

on:
  push:
    branches: [ main ]
  workflow_dispatch: 
  schedule:
    - cron: '8 * * * *' # Tambi√©n se ejecuta solo todas las noches a las 12 AM

jobs:
  test:
    runs-on: ubuntu-latest

    steps:
    - name: Descargar codigo del repo
      uses: actions/checkout@v4

    - name: Configurar Python
      uses: actions/setup-python@v5
      with:
        python-version: '3.11'

    - name: Instalar librerias
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt

    - name: Ejecutar Pruebas de la API
      run: |
        python -m pytest test_api.py --html=reporte_final.html --self-contained-html

    - name: Guardar Reporte como Artefacto
      uses: actions/upload-artifact@v4
      with:
        name: reporte-de-calidad
        path: reporte_final.html
